<% const signupUrl='/oauth2/v1/interaction/' + details.uuid + '/' + 'signup' ;
const forgotPasswordUrl='/oauth2/v1/interaction/' + details.uuid + '/' +
'forgot-password' ; var showEye=false; %>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Page Title</title>

  <!-- Adding the CDN for intl-tel-input -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.19/build/css/intlTelInput.css"
  />
</head>
<body onload="defaultEye()">
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.19/build/js/intlTelInput.min.js"></script>

  <script>
    function getCookie(cname) {
      let name = cname + "=";
      let decodedCookie = decodeURIComponent(document.cookie);
      let ca = decodedCookie.split(";");
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == " ") {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }

    function onSignup(client) {
      if (client == "foyrcommunity") {
        return "https://accounts.foyr.com/oauth2/v1/auth?client_id=foyrcommunity&scope=openid%20profile&response_type=code&redirect_uri=https://community.foyr.com/callback/&state=eyJzdGF0ZSI6Imh0dHBzOi8vY29tbXVuaXR5LmZveXIuY29tL2xvZ2luL2NhbGxiYWNrIn0=&utm_source=newsignup&utm_campaign=prod&utm_medium=organic&type=signup";
      }

      if (client == "foyrboost") {
        return "https://accounts.foyr.com/oauth2/v1/auth?client_id=foyrboost&scope=openid%20profile&response_type=code&redirect_uri=https://boost.foyr.com/callback/&state=4zMhyYUXoW&utm_source=newsignup&utm_campaign=prod&utm_medium=organic&type=signup";
      }

      return "https://accounts.foyr.com/oauth2/v1/auth?client_id=neo&scope=openid%20profile&response_type=code&redirect_uri=https://neo.foyr.com/login/callback&state=eyJzdGF0ZSI6Imh0dHBzOi8vbmVvLmZveXIuY29tL2xvZ2luL2NhbGxiYWNrIn0=&utm_source=newsignup&utm_campaign=prod&utm_medium=organic&type=signup";
    }

    const defaultEye = function () {
      document.getElementById("hidden-eye").style.display = "block";
      document.getElementById("show-eye").style.display = "none";
    };

    const showPassword = function () {
      var x;
      x = document.getElementById("password-input");
      if (x.type === "password") {
        document.getElementById("hidden-eye").style.display = "none";
        document.getElementById("show-eye").style.display = "block";
        x.type = "text";
        showEye = true;
      } else {
        x.type = "password";
        document.getElementById("hidden-eye").style.display = "block";
        document.getElementById("show-eye").style.display = "none";
        showEye = false;
      }
    };

    const showPasswordText = function () {
      if (document.querySelector("#password input").type == "password")
        document.querySelector("#password input").type = "text";
      else if (document.querySelector("#password input").type == "text")
        document.querySelector("#password input").type = "password";
    };

    const avoidSpace = function (event) {
      let k = event ? event.which : window.event.keyCode;
      if (k == 32) return false;
    };

    const validateForm = function () {
      let password = document.getElementById("password-input").value;
      let email = document.getElementById("email-input").value;
      let submit = document.getElementById("submit-button");
      if (email && password) {
        submit.classList.remove("disabled");
      } else {
        if (submit.className.indexOf("disabled") === -1) {
          submit.classList.add("disabled");
        }
      }
    };

    function onSignIn(googleUser) {
      var authResponse = googleUser.getAuthResponse();
      window.open(
        `<%-details.googleUrl%>&code=${authResponse.id_token}`,
        "_self"
      );
    }

    gapi.load("auth2", function () {
      // Retrieve the singleton for the GoogleAuth library and set up the client.
      auth2 = gapi.auth2.init({
        client_id:
          "46521551054-dq2dd588gmoirnbdu5th5s74agfid1v6.apps.googleusercontent.com",
        cookiepolicy: "single_host_origin",
        // Request scopes in addition to 'profile' and 'email'
        //scope: 'additional_scope'
      });
      auth2.attachClickHandler(
        document.getElementById("googleBTN"),
        {},
        onSignIn
      );
    });

    //Facebook login by Ayaz Qureshi 12-11-2024

    // Function to handle Facebook login
    function onFacebookSignIn() {
      FB.login(
        function (response) {
          if (response.authResponse) {
            console.log("response---->", response);
            // User is logged in and authorized
            const accessToken = response.authResponse.accessToken;

            window.open(
              `<%-details.facebookUrl%>&code=${accessToken}`,
              "_self"
            );
            // Fetch user details using the access token
            FB.api(
              "/me",
              { fields: "id,name,email" },
              function (userInfoResponse) {
                if (userInfoResponse && !userInfoResponse.error) {
                  console.log("User Info:", userInfoResponse); // Contains id, name, email
                  // You can now process the user information (id, name, email)
                } else {
                  console.log(
                    "Error fetching user info:",
                    userInfoResponse.error
                  );
                }
              }
            );
          } else {
            console.log("User cancelled login or did not fully authorize.");
          }
        },
        { scope: "email,public_profile" }
      ); // Request email and profile permissions
    }

    // Initialize Facebook SDK
    window.fbAsyncInit = function () {
      FB.init({
        appId: "529362799975627", // Replace with your Facebook App ID
        cookie: true,
        xfbml: true,
        version: "v13.0",
      });
      document
        .getElementById("facebookBTN")
        .addEventListener("click", onFacebookSignIn);
    };

    // let toggleForm = { initial: true, emailForm: false, phoneForm: false };

    function toggleEmailForm(clickFrom) {
      //   toggleForm.initial = false;
      //   toggleForm.emailForm = true;

      const inputDivisons = document.querySelector("#initial");
      const emailForm = document.querySelector("#email-form");
      const phoneForm = document.getElementById("phone-form");

      // Conditionally add the class 'with-google' based on toggleform.initform
      if (clickFrom === "email") {
        // if (!toggleForm.initial && toggleForm.emailForm) {
        // Array.from(inputDivisons).map(item => item.style.display = 'none')  // Add the class
        inputDivisons.style.display = "none";
        emailForm.style.display = "block";
        phoneForm.style.display = "none";
        // }
      }

      if (clickFrom === "phone") {
        // if (!toggleForm.initial && toggleForm.phoneForm) {
        // Array.from(inputDivisons).map(item => item.style.display = 'none')  // Add the class
        inputDivisons.style.display = "none";
        emailForm.style.display = "none";
        phoneForm.style.display = "block";
        // }
      }
    }

    // Function to toggle password visibility
    function togglePasswordVisibility() {
      const passwordField = document.getElementById("password-input");
      const toggleIcon = document.getElementById("toggle-icon");

      // Toggle the input field type between 'password' and 'text'
      if (passwordField.type === "password") {
        passwordField.type = "text"; // Show password
        toggleIcon.src = "/measure-assets/img/hideicon.svg"; // Change icon to show
      } else {
        passwordField.type = "password"; // Hide password
        toggleIcon.src = "/measure-assets/img/showIcon.svg"; // Change icon to hide
      }
    }

    // Initialize the intl-tel-input on the input field

    const phoneInputField = document.querySelector("#phone_number");

    const phoneInput = window.intlTelInput(phoneInputField, {
      initialCountry: "us",
      preferredCountries: ["us", "gb", "in"],
      separateDialCode: true,
      utilsScript:
        "https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.19/build/js/utils.js",
    });

    document
      .querySelector(".submit-btn")
      .addEventListener("click", function () {
        if (phoneInput.isValidNumber()) {
          alert("Valid phone number!");
        } else {
          alert("Invalid phone number!");
        }
      });

    function redirectToSignUp() {
      // Fetching the grant value from the backend, passed via EJS
      const grant = "<%= details.params.client_id %>"; // Assuming grant is available from the backend
      if (grant) {
        // Redirect to the signup page with the dynamic 'grant' value
        window.location.href = grant + "/signup";
      } else {
        console.error("Grant value is missing!");
      }
    }

    function gtag_report_conversion(url) {
            console.log('called aleem')
            // var callback = function () {
            //     if (typeof url != 'undefined') {
            //         window.location = url
            //     }
            // }
            // gtag('event', 'conversion', {
            //     send_to: 'AW-789738350/Rhx-CL6xyaYBEO7myfgC',
            //     event_callback: callback
            // })
            return false
        }
  </script>


    
  <div class="content-wrapper">
    <div class="heading">
      <img src="/measure-assets/img/3dmodel.svg" alt="" />
    </div>
    <div class="partation-warpper">
      <div class="content-container">
        <div class="container">
          <div class="login-wrapper">
            <div class="login">Log in</div>
            <div class="paragraph" onclick="redirectToSignUp()">
              Don’t have an account? <span>SignUp</span>
            </div>
          </div>

          <!-- initial login -->

          <div id="initial">
            <div class="login-options">
              <div class="with-google with sign-up-with-google" id="googleBTN">
                <img src="/measure-assets/img/google.svg" alt="" /> Continue
                with Google
              </div>
              <div class="with-phone with" onclick="toggleEmailForm('phone')">
                <img src="/measure-assets/img/phone.svg" alt="" />Continue with
                Phone Number
              </div>
              <div class="email with" onclick="toggleEmailForm('email')">
                <img src="/measure-assets/img/mail.svg" alt="" />Continue with
                Email
              </div>
            </div>
          </div>

          <!-- email login -->
          <form
            class="right-side"
            id="email-form"
            action="/oauth2/v1/interaction/<%= details.uuid %>/login"
            method="post"
            onsubmit="gtag_report_conversion()"
          >
            <div class="login-options">
              <div class="with email-input">
                <input name="email" type="text" id="email-input" placeholder=" Email" />
                <label for="name">Email</label>
              </div>
              <div class="with password-input">
                <input
                  type="password"
                  placeholder="Password"
                  class="password-field"
                  id="password-input"
                  required
                  onkeypress="return avoidSpace(event)" onkeyup="validateForm()"
                />
                <label for="name">Password</label>
                <div class="hide" onclick="togglePasswordVisibility()">
                  <img
                    src="/measure-assets/img/showIcon.svg"
                    id="toggle-icon"
                    alt=""
                  />
                </div>
              </div>

              <div class="error-message">Wrong Password!</div>

              <div class="check-error">
                <div class="check-box">
                  <div class="check-input">
                    <input type="checkbox" />
                  </div>
                  <div class="text">Remember me</div>
                </div>
                <div class="forgot-password">Forgot Password ?</div>
              </div>
              <button type="submit" class="login-button">Login</button>
              <div class="signin-with">
                <div class="part1"></div>
                <div class="part2">Or login with</div>
                <div class="part3"></div>
              </div>
              <div class="with-google with sign-up-with-google" id="googleBTN">
                <img src="/measure-assets/img/google.svg" alt="" /> Continue
                with Google
              </div>
            </div>
          </form>

          <div id="phone-form">
            <div class="login-options">
              <div class="numberinput">
                <!-- Updated input element with ID -->
                <input
                  type="tel"
                  id="phone_number"
                  class="email-input"
                  placeholder="Phone Number"
                />
              </div>
              <div class="with login submit-btn">Submit</div>
            </div>
          </div>

          <div class="terms">
            By creating an account you agree with our
            <span>Terms</span> &nbsp;and&nbsp; <span>Privacy Policy</span>
          </div>
        </div>
      </div>
      <div class="image-container">
        <img src="/measure-assets/img/loginpageimage.svg" alt="" />
      </div>
    </div>
  </div>
</body>
